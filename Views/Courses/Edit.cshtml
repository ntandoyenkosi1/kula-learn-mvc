@model KulaMVC.Models.Course

@{
    ViewData["Title"] = "Edit";
}
@* <a asp-action="Preview" asp-route-collectionID="@collectionID">Preview</a> *@

<div>
    <form asp-action="Edit">
        <div role="alert" class="fade custom-alert alert alert-primary show">
            <div class="alert-heading h4">
                <h1><b>Edit Course</b></h1>
            </div>
        </div>
        <a asp-action="Details" asp-route-id="@Model.ID" class="btn">Edit Modules</a>
        <div class="card">
        <h4>@Model.title</h4>
        <div>
            <label asp-for="title" class="control-label"><b>Update the course title.</b></label>
            <input asp-for="title" class="form-control" />
            <span asp-validation-for="title" class="text-danger"></span>
        </div>
        <div>
            <label class="control-label"><b>Language. (default: English)</b></label>
            <input id="language" class="form-control" type="text" readonly="" value="en">
        </div>
        <div class="form-floating textarea mb-3">
            <label asp-for="shortDescription" class="control-label">Use this area to give a short description of the new
                module.</label>
            <textarea asp-for="shortDescription" class="form-control"></textarea>
            <span asp-validation-for="shortDescription" class="text-danger"></span>
        </div>
        <div>
            <input type="text" asp-for="imageUrl" id="imageUrl" hidden>
        </div>
        <div class="form-group">
            <label asp-for="published" class="control-label"><b>Publish information.</b></label>
            <select asp-for="published" asp-items="Html.GetEnumSelectList<Publish>()" class="form-control">
                <option selected="selected" value="">Please select</option>
            </select>
        </div>
        <div class="form-group">
            <label asp-for="visibility" class="control-label"><b>Visibility information</b></label>
            <select asp-for="visibility" asp-items="Html.GetEnumSelectList<Visible>()" class="form-control">
                <option selected="selected" value="">Please select</option>
            </select>
        </div>
        <img alt="" class="rounded mx-auto d-block im" id="image-source" src="@Model.imageUrl"
            style="max-width: 150px; max-height: 150px;">
        <div class="mb-3"><label for="file" class="form-label"><b>Upload a picture for the course</b></label><input
                class="form-control form-control-sm" onchange="handleFileUpload(this)" id="file" type="file"></div>
        <div>
            <input type="submit" value="Save" class="btn">
            </div>
    </form>
</div>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
    const handleFileUpload = async (e) => {
        var input = document.getElementById("file");
        var files = input.files;
        const formdata = new FormData();
        formdata.append("image", files[0], files[0].name);
        const requestOptions = {
            method: 'POST',
            body: formdata,
            redirect: 'follow'
        };
        await fetch("https://api.imgbb.com/1/upload?key=8d0a7e3689b931e211b03dbd58eab571", requestOptions)
            .then(response => response.json())
            .then((result) => {
                alert("Image uploaded successfully.")
                document.getElementById('imageUrl').value = result.data.url;
            })
    }
</script>